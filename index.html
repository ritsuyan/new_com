<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no">
    <title></title>
    <link rel="stylesheet" href="css/base.css">
    <link rel="stylesheet" href="css/style.css">
    <style>
    </style>
</head>

<body>
    <div class="app-page">
        <form action="">
            <div class="con">
                <a href="uniwebview://close" id="close">X</a>
                <div class="ques ques1" style="display: block;" type='single'>
                    <div class="ques-tit">
                        (
                        <span>1</span>/15). 您是汉子还是妹子！（单选）
                    </div>
                    <div class="ques-body">
                        <div class="answer2 fl ">
                            <label>
                                <input type="radio" name="gender" value="1"> 汉子
                                <span></span>

                            </label>
                        </div>
                        <div class="answer2 fl ">
                            <label>
                                <input type="radio" name="gender" value="2"> 妹子
                                <span></span>

                            </label>
                        </div>
                    </div>
                    <a href="javascript:;" class="next">下一题</a>
                    <a href="javascript:;" class="next active" style="opacity:0;">下一题</a>
                </div>
                <div class="ques ques2" style="display: none;" type='single'>
                    <div class="ques-tit">
                        (
                        <span>2</span>/15).请问您属于哪一代人？（单选）
                    </div>
                    <div class="ques-body">
                        <div class="answer2 fl ">
                            <label>
                                <input type="radio" name="age" value="1"> 00后
                                <span></span>

                            </label>
                        </div>
                        <div class="answer2 fl ">
                            <label>
                                <input type="radio" name="age" value="2"> 95后
                                <span></span>

                            </label>
                        </div>
                        <div class="answer2 fl ">
                            <label>
                                <input type="radio" name="age" value="3"> 90后
                                <span></span>

                            </label>
                        </div>
                        <div class="answer2 fl ">
                            <label>
                                <input type="radio" name="age" value="4"> 80后
                                <span></span>

                            </label>
                        </div>
                        <div class="answer2 fl ">
                            <label>
                                <input type="radio" name="age" value="5">70后及以上
                                <span></span>
                            </label>
                        </div>
                    </div>
                    <a href="javascript:;" class="next">下一题</a>
                </div>
                <div class="ques ques3" style="display: none;" type='multiple'>
                    <div class="ques-tit">
                        (
                        <span>3</span>/15).您平常了解新手机游戏的渠道主要是什么？（最多选2项）
                    </div>
                    <div class="ques-body">
                        <!-- on 的意思是选中上色状态 取消则没有-->
                        <div class="answer2  fl ">
                            <label>
                                <input type="checkbox" value="1">网络直播时主播宣传
                                <span></span>
                            </label>

                        </div>
                        <div class="answer2 fl ">
                            <label>
                                <input type="checkbox" value="2">自己主动去游戏网站上找对味的游戏
                                <span></span>
                            </label>
                        </div>
                        <div class="answer2 fl ">
                            <label>
                                <input type="checkbox" value="3">周围朋友玩的比较多的话，跟风去玩
                                <span></span>
                            </label>
                        </div>
                        <div class="answer2 fl ">
                            <label>
                                <input type="checkbox" value="4">看应用商店的推荐或者排名
                                <span></span>
                            </label>
                        </div>
                        <div class="answer2 fl ">
                            <label>
                                <input type="checkbox" value="5">微博大V宣传
                                <span></span>
                            </label>
                        </div>
                        <div class="answer2 fl">
                            <label>
                                <input type="checkbox" value="6">网站广告
                                <span></span>
                            </label>
                        </div>
                        <div class="answer2 fl">
                            <label for="oth">
                                <input type="checkbox" value="7" class="other" id='oth'>其他
                                <span class="other_s"></span>
                                <input type="text" class="otplace" placeholder="请填写其他了解渠道">
                            </label>
                        </div>
                    </div>
                    <a href="javascript:;" class="next">下一题</a>
                </div>
                <div class="ques ques4" style="display: none;" type='multiple'>
                    <div class="ques-tit">
                        (
                        <span>4</span>/15). 下列游戏中，有那些是您曾经玩过的游戏？（多选）
                    </div>
                    <div class="clearfix ques-body">
                        <!-- on 的意思是选中上色状态 取消则没有-->
                        <div class="answer2  fl ">
                            <label>
                                <input type="checkbox" value="1">王者荣耀
                                <span></span>
                            </label>
                        </div>
                        <div class="clearfix"></div>
                        <div class="answer2 fl ">
                            <label>
                                <input type="checkbox" value="2">Dota/Dota2-丛林肉搏
                                <span></span>
                            </label>
                        </div>
                        <div class="answer2 fl ">
                            <label>
                                <input type="checkbox" value="3">绝地求生
                                <span></span>
                            </label>
                        </div>
                        <div class="answer2 fl ">
                            <label>
                                <input type="checkbox" value="4">荒野行动
                                <span></span>
                            </label>
                        </div>
                        <div class="answer2 fl ">
                            <label>
                                <input type="checkbox" value="5">小米枪战
                                <span></span>
                            </label>
                        </div>
                        <div class="answer2 fl">
                            <label>
                                <input type="checkbox" value="6">终结者2：审判日
                                <span></span>
                            </label>
                        </div>
                        <div class="answer2 fl">
                            <label>
                                <input type="checkbox" value="7">像素人大作战
                                <span></span>
                            </label>
                        </div>
                    </div>

                    <a href="javascript:;" class="next">下一题</a>
                </div>
                <div class="ques ques5" style="display: none;" type='single'>
                    <div class="ques-tit">
                        (
                        <span>5</span>/15).您认为《起凡大乱斗》的上手难度如何？（单选）
                    </div>

                    <div class="ques-body">

                        <div class="answer2 fl ">
                            <label>
                                <input type="radio" name="gender" value="1" checked> 容易
                                <span></span>
                                <br>
                            </label>
                        </div>

                        <div class="answer2 fl ">
                            <label>
                                <input type="radio" name="gender" value="2" checked> 一般
                                <span></span>
                                <br>
                            </label>
                        </div>

                        <div class="answer2 fl ">
                            <label>
                                <input type="radio" name="gender" value="3" checked> 较难
                                <span></span>
                                <br>
                            </label>
                        </div>

                    </div>

                    <a href="javascript:;" class="next">下一题</a>
                </div>
                <div class="ques ques6" style="display: none;" type='single'>
                    <div class="ques-tit">
                        (
                        <span>6</span>/15).您觉得《起凡大乱斗》是否要增加新的匹配模式？（单选）
                    </div>

                    <div class="ques-body">

                        <div class="answer2 fl ">
                            <label>
                                <input type="radio" name="gender" value="1" checked> 不需要，3V3匹配很满意
                                <span></span>
                                <br>
                            </label>
                        </div>

                        <div class="answer2 fl ">
                            <label>
                                <input type="radio" name="gender" value="2" checked> 需要增加单人匹配
                                <span></span>
                                <br>
                            </label>
                        </div>

                        <div class="answer2 fl ">
                            <label>
                                <input type="radio" name="gender" value="3" checked> 需要增加其他新玩法
                                <span></span>
                                <br>
                            </label>

                        </div>
                    </div>
                    <a href="javascript:;" class="next">下一题</a>
                </div>

                <div class="ques ques7" style="display: none;" type='single'>
                    <div class="ques-tit">
                        (
                        <span>7</span>/15).您认为《起凡大乱斗》的上手难度如何？（单选）
                    </div>

                    <div class="ques-body">

                        <div class="answer2 fl ">
                            <label>
                                <input type="radio" name="gender" value="1" checked> 非常慢
                                <span></span>
                                <br>
                            </label>
                        </div>


                        <div class="answer2 fl ">
                            <label>
                                <input type="radio" name="gender" value="2" checked> 有点慢
                                <span></span>
                                <br>
                            </label>
                        </div>

                        <div class="answer2 fl ">
                            <label>
                                <input type="radio" name="gender" value="3" checked> 刚好
                                <span></span>
                                <br>
                            </label>
                        </div>



                        <div class="answer2 fl ">
                            <label>
                                <input type="radio" name="gender" value="4" checked> 有点快
                                <span></span>
                                <br>
                            </label>
                        </div>

                    </div>

                    <a href="javascript:;" class="next">下一题</a>
                </div>

                <div class="ques ques8" style="display: none;" type='single'>
                    <div class="ques-tit">
                        (
                        <span>8</span>/15).《起凡大乱斗》单局游戏时长您是否满意？（单选）
                    </div>

                    <div class="ques-body">

                        <div class="answer2 fl ">
                            <label>
                                <input type="radio" name="gender" value="1" checked> 非常满意
                                <span></span>
                                <br>
                            </label>
                        </div>

                        <div class="answer2 fl ">
                            <label>
                                <input type="radio" name="gender" value="2" checked> 一般
                                <span></span>
                                <br>
                            </label>
                        </div>

                        <div class="answer2 fl ">
                            <label>
                                <input type="radio" name="gender" value="3" checked> 不喜欢
                                <span></span>
                                <br>
                            </label>
                        </div>

                    </div>

                    <a href="javascript:;" class="next">下一题</a>
                </div>

                <div class="ques ques9" style="display: none;" type='single'>
                    <div class="ques-tit">
                        (
                        <span>9</span>/15).您对《起凡大乱斗》的美术风格感到满意吗？（单选）
                    </div>

                    <div class="ques-body">

                        <div class="answer2 fl ">
                            <label>
                                <input type="radio" name="gender" value="1" checked> 非常满意
                                <span></span>
                                <br>
                            </label>
                        </div>

                        <div class="answer2 fl ">

                            <label>
                                <input type="radio" name="gender" value="2" checked> 一般
                                <span></span>
                                <br>
                            </label>
                        </div>

                        <div class="answer2 fl ">
                            <label>
                                <input type="radio" name="gender" value="3" checked> 不喜欢
                                <span></span>
                                <br>
                            </label>
                        </div>

                    </div>

                    <a href="javascript:;" class="next">下一题</a>
                </div>

                <div class="ques ques10" style="display: none;" type='single'>
                    <div class="ques-tit">
                        (
                        <span>10</span>/15).玩《起凡大乱斗》手游时，是否存在游戏卡顿等现象？（单选）
                    </div>
                    <div class="ques-body">

                        <div class="answer2 fl ">
                            <label>
                                <input type="radio" name="gender" value="1" checked> 不存在
                                <span></span>
                                <br>
                            </label>
                        </div>

                        <div class="answer2 fl ">
                            <label>
                                <input type="radio" name="gender" value="2" checked> 偶尔存在
                                <span></span>
                                <br>
                            </label>
                        </div>

                        <div class="answer2 fl ">
                            <label>
                                <input type="radio" name="gender" value="3" checked> 时常出现
                                <span></span>
                                <br>
                            </label>
                        </div>


                    </div>
                    <a href="javascript:;" class="next">下一题</a>
                </div>

                <div class="ques ques11" style="display: none;" type='single'>
                    <div class="ques-tit">
                        (
                        <span>11</span>/15).目前《起凡大乱斗》的道具是否够用？（单选）
                    </div>
                    <div class="ques-body">

                        <div class="answer2 fl ">
                            <label>
                                <input type="radio" name="gender" value="1"> 够用
                                <span></span>
                                <br>
                            </label>
                        </div>

                        <div class="answer2 fl ">
                            <label>
                                <input type="radio" name="gender" value="2"> 希望增加伤害类道具
                                <span></span>
                                <br>
                            </label>
                        </div>

                        <div class="answer2 fl ">
                            <label>
                                <input type="radio" name="gender" value="3"> 希望增加治愈类道具
                                <span></span>
                                <br>
                            </label>
                        </div>

                        <div class="answer2 fl ">
                            <label>
                                <input type="radio" name="gender" value="4" class="other"> 希望增加其他类别道具
                                <span class="other_s"></span>
                                <input type="text" class="otplace" placeholder="请填写其他了解渠道" style='width: 25%;'>
                            </label>

                        </div>

                    </div>
                    <a href="javascript:;" class="next">下一题</a>
                </div>

                <div class="ques ques12" style="display: none;" type='multiple'>
                    <div class="ques-tit">
                        (
                        <span>12</span>/15).在十个免费英雄中，请选出最多三个，您相对比较喜欢的英雄（选择三项）
                    </div>
                    <div class="ques-body">
                        <!-- on 的意思是选中上色状态 取消则没有-->
                        <div class="answer2  fl ">
                            <label>
                                <input type="checkbox" value="1">许褚
                                <span></span>
                            </label>
                        </div>

                        <div class="answer2 fl ">
                            <label>
                                <input type="checkbox" value="2">张飞
                                <span></span>
                            </label>
                        </div>
                        <div class="answer2 fl ">
                            <label>
                                <input type="checkbox" value="3">貂蝉
                                <span></span>
                            </label>
                        </div>
                        <div class="answer2 fl ">
                            <label>
                                <input type="checkbox" value="4">黄忠
                                <span></span>
                            </label>
                        </div>
                        <div class="answer2 fl ">
                            <label>
                                <input type="checkbox" value="5">孙尚香
                                <span></span>
                            </label>
                        </div>
                        <div class="answer2 fl">
                            <label>
                                <input type="checkbox" value="6">曹休
                                <span></span>
                            </label>
                        </div>
                        <div class="answer2 fl">
                            <label>
                                <input type="checkbox" value="7">左慈
                                <span></span>
                            </label>
                        </div>
                        <div class="answer2 fl">
                            <label>
                                <input type="checkbox" value="8">小乔
                                <span></span>
                            </label>
                        </div>
                        <div class="answer2 fl">
                            <label>
                                <input type="checkbox" value="9">魏延
                                <span></span>
                            </label>
                        </div>
                        <div class="answer2 fl">
                            <label>
                                <input type="checkbox" value="10">夏侯渊
                                <span></span>
                            </label>

                        </div>
                    </div>
                    <a href="javascript:;" class="next">下一题</a>
                </div>

                <div class="ques ques13" style="display: none;" type='text'>
                    <div class="ques-tit">
                        (
                        <span>13</span>/15).关于《起凡群雄大乱斗》整体的游戏手感，英雄玩法，地图玩法，或者有什么想吐槽的，请大佬留下您的意见！（有抽取部分玩家发放额外Q币或游戏礼包奖励哦）
                    </div>
                    <div class="write2  ques-body">
                        <textarea maxlength="200" class="textV"></textarea>
                        <span id='tdd'>0/200</span>
                    </div>
                    <a href="javascript:;" class="next" id="textA">下一题</a>
                </div>
                <div class="ques ques14" style="display: none;" type='text'>
                    <div class="ques-tit">
                        (
                        <span>14</span>/15).您的手机联系方式是？【非常重要，请务必准确填写】
                    </div>
                    <div class="write3  ques-body">
                        <input type="text" id="phone" class="textV">
                    </div>
                    <a href="javascript:;" class="next" id="ph">下一题</a>
                </div>
                <div class="ques ques15" style="display: none;" type='text'>
                    <div class="ques-tit">
                        (
                        <span>15</span>/15).您的QQ联系方式是？【方便您加入QQ群哦，一起组队一起飞！】
                    </div>
                    <div class="write3  ques-body">
                        <input type="text" id="qq" class="textV">
                    </div>
                    <a href="javascript:;" class="next" id="submit">完成问卷</a>
                </div>
            </div>
        </form>
    </div>

    <script src="js/zepto.min.js"></script>
    <script src="js/alert.min.js"></script>
    <script>
        $(function () {
            //设置font-size
            setrFont(), // verify();
            window.addEventListener('resize', function () {
         //       alert('toggle')
                setrFont()
            }, false);
            /*
              存储表单
              单选从1到n存数字, 多选存数组从1到n, 填空存字符串
            */
            var dArr = [];
            var rPhone = /^((0\d{2,3}-\d{7,8})|(1([358][0-9]|4[579]|66|7[0135678]|9[89])[0-9]{8}))$/;
            var rQq = /^\d{5,10}$/;
            // 走下一题就相当于input 有值了 直接走就行了 最后一起提交。
            $('input').click(function (e) {
                var currP = $(e.target).parents('.ques');
                currP.find(':checked').length > 0 ? currP.find('.next').addClass('active') : currP.find(
                    '.next').removeClass('active')
            })

            $(".next").click(function (e) {
                if($(e.target).attr('id') === 'submit') return;
                goNext(e);
            })

            // 限制多选项数 每次选择事件时确认项数
            $.fn.limit = function (n) {
                console.log(n, this)
                var self = this;
                this.click(function (e) {
                    console.log('e', $(e.target))
                    if ($(e.target)[0].type === 'text') return;
                    console.log('se', self.filter('input[type="checkbox"]').filter(':checked').length,
                        self);
                    (self.filter('input[type="checkbox"]').filter(':checked').length === n) ? (self
                        .filter('input[type="checkbox"]').not(':checked').attr('disabled',
                            true)) :
                    (self.not(":checked").removeAttr("disabled"));

                    // 选中样式效果
                    if ($(e.target).parents('.answer2').hasClass('on')) {
                        $(e.target).parents('.answer2').removeClass('on')
                    } else {
                        $(e.target).parents('.answer2').addClass('on')
                    }
                })
            }
            $(".ques3 input").limit(2);
            $(".ques4 input").limit(8);
            $(".ques12 input").limit(3);

            $("input[type='radio']").click(function (e) {
                var hasSelectArr = $(e.target).parents('.ques-body').find('.on');
                console.log(hasSelectArr, $(e.target))
                if (hasSelectArr.length) {
                    hasSelectArr.removeClass('on'), $(e.target).parents('.answer2').addClass('on')
                } else {
                    $(e.target).parents('.answer2').addClass('on')
                }
            })

            // textarea 限制长度
            $('textarea').keyup(function () {
                if (this.value.length > 200) {
                    return false;
                } else if (this.value.length > 0 && this.value.length < 200) {
                    //点亮按钮
                    $('#textA').addClass('active')
                } else {
                    $('#textA').removeClass('active')
                }
                $("#tdd").html(this.value.length + '/' + 200);
            })
            $(document).keyup(function () {
                console.log('keyup', $('#phone').val())
                regC($('#phone'), rPhone, $('#ph')), regC($('#qq'), rQq, $('#submit'))
            })

            // 正则通用方法
            function regC(elem, reg, btn) {
                if (!reg.test(Number(elem.val()))) {
                    console.log('未通过');
                    btn.removeClass('active')
                    return;
                } else {
                    btn.addClass('active')
                }
            }

            function save(e) {
                // 为空可能
                var currT = $(e.target).parent().attr('type')
                var inputArr = $(e.target).parent().find(":checked");
                var textVal = $(e.target).parent().find(".textV");
                if (currT === 'single') {
                    // 单选自然只有一个值     otplace
                    if ($(inputArr[0]).hasClass('other')) {
                        var ot_ = $(e.target).parent().find(".otplace");
                        dArr.push({
                            key: $(inputArr[0]).val(),
                            value: ot_.val()
                        });
                    } else {
                        dArr.push(Number(inputArr[0].value))
                    }
                    // "其他" 
                } else if (currT === 'multiple') {
                    // 多选
                    console.log('ipp', inputArr)
                    var to = [];
                    // 如果有其他_ 类型选择框选中了 checkbox类型的长度-1
                    for (var index = 0; index < inputArr.length; index++) {
                        if ($(inputArr[index]).hasClass('other')) {
                            var ot_ = $(inputArr[index]).parent().find(".otplace");
                            to.push({
                                key: $(inputArr[index]).val(),
                                value: ot_.val()
                            });
                        } else {
                            to.push(Number(inputArr[index].value))
                        }
                    }
                    dArr.push(to)
                } else if (currT === 'text') {
                    dArr.push(textVal.val())
                }
            }

            function setrFont() {
                var fontsize = 16 * $(window).width() / 320;
                if (fontsize > 67.5) {
                    fontsize = 67.5;
                }
                $('html').css('font-size', fontsize);
            }

            function goNext(e) {
                // 必须满足条件才给走下一题 存储此题内容  
                if (!$(e.target).hasClass('active')) return;
                save(e), $(e.target).parent().hide().next().show()
                console.log('dar', dArr)
            }

            function GetQueryString(name) {
                var reg = new RegExp("(^|&)" + name + "=([^&]*)(&|$)");
                var r = window.location.search.substr(1).match(reg);
                if (r != null) return unescape(r[2]);
                return null;
            }

            // 校验是否填写过问卷           
            function verify() {
                $.ajax({
                    type: "POST",
                    url: "/survey/game/verify",
                    data: {
                        version: 1,
                        token: GetQueryString('token'),
                    },
                    dataType: 'json',
                    success: function (data) {
                        if (data.code === 0) { //提交成功后确认提交消失 修改出现 表单致灰
                            data.result == false ? '' : $.alert('注意，您已填写过问卷');                       
                        } else {
                            $.alert('系统错误')
                        }
                    },
                    error: function (jqXHR, textStatus, error) {
                        var url = jqXHR.url;
                        /* replace caturl with url in your append */
                        $.alert('系统错误' + textStatus)
                    }
                });
            }

            $('#submit').click(function (e) {
                $.ajax({
                    type: "POST",
                    url: "/survey/game",
                    data: {
                        version: 1,
                    //    token: GetQueryString('token'),
                        data: JSON.stringify(dArr)
                    },
                    dataType: 'json',
                    success: function (data) {
                        if (data.code === 0) { //提交成功后确认提交消失 修改出现 表单致灰
                            $.alert('提交表单成功，请返回游戏内领取奖励！')
                            //  $(e.target).parent().hide().next().show(), 
                        } else {
                            $.alert('未知故障，提交表单失败')
                        }
                    },
                    error: function (jqXHR, textStatus, error) {
                        var url = jqXHR.url;
                        /* replace caturl with url in your append */
                        $.alert('未知错误' + textStatus)
                    }
                });

            })
        });
    </script>
</body>

</html>

<!-- 
  @1 错误处理   完成
  @2 关闭页面按钮 完成
  @3 适配滚动条  完成
  @4 校验是否提交过问卷 完成  
-->